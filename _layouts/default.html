---
layout: nil
---

<!DOCTYPE html>

{% comment %}
- Default language: English - Detect language by URL prefix /es or /en 
{% endcomment %} 

{% assign url = page.url | default: "/" | replace: ".html", "" %} 
{% assign is_es = false %} 
{% assign is_en = true %} 
{% if url == "/es" or url == "/es/" or url contains "/es/" %} 
  {% assign is_es = true %} 
  {% assign is_en = false %} 
{% elsif url == "/en" or url == "/en/" or url contains "/en/" %} 
  {% assign is_es = false %} 
  {% assign is_en = true %} 
{% endif %}

<html lang="{% if is_es %}es{% else %}en{% endif %}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      {{ page.title }}{% if site.title_separator %}{{ site.title_separator }}{%
      endif %}{{ site.title }}
    </title>
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />
    <link rel="stylesheet" href="/assets/css/dark.css" />
    <script>
      (function () {
        const saved = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        const theme = saved || (prefersDark ? "dark" : "light");
        document.documentElement.setAttribute("data-theme", theme);
      })();
    </script>
  </head>
  <body>
    <button id="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
    <main style="max-width: 820px; margin: 0 auto; padding: 1.25rem">
      {% include lang-switch-global.html %} {% include site-header.html %} {{
      content }}
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const btn = document.getElementById("theme-toggle");
        if (!btn) return;

        const prefersDark = () =>
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;

        const getStoredTheme = () => {
          try {
            return localStorage.getItem("theme");
          } catch {
            return null;
          }
        };

        const setStoredTheme = (v) => {
          try {
            localStorage.setItem("theme", v);
          } catch {}
        };

        const setTheme = (theme) => {
          document.documentElement.setAttribute("data-theme", theme);
          updateIconAndLabel(theme);
        };

        function updateIconAndLabel(theme) {
          const isDark = theme === "dark";
          btn.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";

          const labelDark =
            "{% if is_es %}Cambiar a modo oscuro{% else %}Switch to dark mode{% endif %}";
          const labelLight =
            "{% if is_es %}Cambiar a modo claro{% else %}Switch to light mode{% endif %}";
          btn.setAttribute("aria-label", isDark ? labelLight : labelDark);
        }

        // Initial theme: stored > system
        const stored = getStoredTheme();
        if (stored === "dark" || stored === "light") {
          setTheme(stored);
        } else {
          setTheme(prefersDark() ? "dark" : "light");
        }

        // Toggle: user choice wins (stored)
        btn.addEventListener("click", function () {
          const current =
            document.documentElement.getAttribute("data-theme") || "light";
          const next = current === "dark" ? "light" : "dark";
          setTheme(next);
          setStoredTheme(next);
        });

        // Follow system changes ONLY if user has not chosen manually
        const mq = window.matchMedia
          ? window.matchMedia("(prefers-color-scheme: dark)")
          : null;
        if (mq && mq.addEventListener) {
          mq.addEventListener("change", function () {
            const s = getStoredTheme();
            if (s === null) setTheme(prefersDark() ? "dark" : "light");
          });
        }
      });
    </script>
  </body>
</html>
